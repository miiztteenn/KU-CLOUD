import { LOADING } from '../../utility';

const END_POINT = 'http://localhost:8000/api/';
const END_POINT_WED = 'http://localhost:8000/';

class staticDataTable {
    constructor() {
        let staticDataTable = null;
        let staticList = null;

        let bindElement = () => {
            $("#btn-add-static").click(function () {
                $("#addStatic").modal('show');
            });

            $("#btn-save-add-static").click(function () {
                addStaticDashboard();
            });
        };

        let addStaticDashboard = () => {
            LOADING.set($("#btn-save-add-static"));
            let static_name = $("#static-name").val();
            $.ajax({
                url: END_POINT + "company/static",
                method: 'POST',
                data: {
                    name: static_name,
                },
                success: (res) => {
                    console.log(res);
                    $("#addStatic").modal('hide');
                    LOADING.reset($("#btn-save-add-static"));
                    this.showLastestDatatable();
                },
                error: (res) => {
                    console.log(res);
                    LOADING.reset($("#btn-save-add-static"));
                }
            });
        };

        let updateDatatableData = () => {
            let Datatable = [];
            staticDataTable.fnClearTable();
            $.each(staticList, function (index, item) {
                let ret = [];
                ret[0] = item.name;
                ret[1] = `<center>
                            <button type="button" class="btn btn-primary btn-sm btn-lookup" key=${item.static_id} data-toggle="tooltip"
                                data-placement="top" title="Look">
                                <i class="fas fa-search"></i>
                            </button>
                            <button type="button" class="btn btn-success btn-sm btn-edit" key=${item.static_id}  data-toggle="tooltip"
                                data-placement="top" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn btn-danger btn-sm btn-delete"  key=${item.static_id}  data-toggle="tooltip"
                                data-placement="top" title="Delete">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                          </center>`;
                Datatable.push(ret);
            });
            staticDataTable.fnAddData(Datatable);

            $(".btn-lookup").unbind().click(function () {
                onBtnLookup($(this).attr('key'));
            });

            $('[data-toggle="tooltip"]').tooltip();
        };

        let onBtnLookup = (key) => {
            window.location.href = END_POINT_WED + "Company/Static/" + key;
        };

        let initialDatatable = () => {
            if (staticDataTable !== null) {
                return false;
            }

            staticDataTable = $('#example').dataTable({});
            console.log(staticDataTable);
        };

        let showDatatableLoadingStatus = (showOrHide) => {
            if (showOrHide) {
                $(".dataTables_wrapper").hide();
                $('#example').hide();
                $('.lds-roller').show();
            }
            else {
                $(".dataTables_wrapper").show();
                $('.lds-roller').hide();
                $('.text-loading').hide();
                $('#example').show();
                $('.text-static').show();
            }
        };

        this.initialAndRun = () => {
            bindElement();
            initialDatatable();
            this.showLastestDatatable();
        };

        this.showLastestDatatable = () => {
            showDatatableLoadingStatus(true);
            $.ajax({
                url: END_POINT + "company/static",
                success: (res) => {
                    showDatatableLoadingStatus(false);
                    staticList = res.data;
                    updateDatatableData();
                },
                error: (res) => {
                    showDatatableLoadingStatus(false);
                }
            });
        };
    }
}

$(document).ready(function () {
    let et = new staticDataTable();
    et.initialAndRun();
});
