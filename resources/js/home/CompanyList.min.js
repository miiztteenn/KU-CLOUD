import {
    deepCopy,
    convertHex,
    randomHexColor,
    aproximateHour,
    filter_hour,
    diff_hours,
    getRndInteger,
    checkAuthRes,
    getFlatObject,
    getFlatObjectV2
} from '../utility';

var companyList  = [];
let searchValue = null;

$(document).ready(function () {
    getCompanyList();
    showLoading(true);
});

$("#search_company_input").keyup(function () {
    if($(this).val().length > 2)
    {
        searchValue = $(this).val();
        showLoading(true);
        getCompanyList();
    }
    else if($(this).val() == "")
    {
        searchValue = null;
        showLoading(true);
        getCompanyList();
    }

});

let showLoading = (isShow) => {
    if(isShow){
        $("#loading").show();
    }
    else{
        $("#loading").hide();
    }
}

function getCompanyList(){

    $.ajax({
        url: END_POINT + "companyList/public",
        method: 'GET',
        data : {
            search : searchValue,
        },
        success: function (result, textStatus, xhr) {
            checkAuthRes(xhr);
            companyList = result.data;
            console.log(companyList);

            appendCardList();
            showLoading(false);
        },
        error: function (error) {
            console.log(error);
        }
    });
}

function appendCardList(){
    let htmlText = "";
    let pathsrc = $("#path_src").val();
    $("#space_list").html(``);
    for(let i = 0; i < companyList.length; i++)
    {
        if(companyList[i].company_name != "KU_CLOUD")
        {
            htmlText += `<div class="col-xl-3 col-6 mt-4">
                <div class="card" style="box-shadow: 0px 0px 13px 1px rgba(0,0,0,0.3);">
                    <div style="text-align:center">
                        <img class="card-img-top" src="${companyList[i].img_logo}" alt="Card image cap" style="height:50%; width:60%; padding-top:10px;">
                    </div>
                    <hr>
                    <div class="card-body" style="padding-top:0px;">
                        <h5 class="card-title">${companyList[i].company_name}</h5>
                        <p class="card-text">${companyList[i].note}</p>
                        <div id="btn_space" style="text-align:right">
                            <button class="btn btn-info" value="${i}">Detail</button>
                        </div>
                    </div>
                </div>
            </div>`;
        }
    }

    $("#space_list").html(htmlText);
    $("#total_company").html(`Total company : ` + companyList.length);
    $("#space_list").on('click', '.btn-info', function () {
        $(".modal-title").html(companyList[$(this).val()].company_name);

        $("#address_detail").html(companyList[$(this).val()].address[0].address_detail);
        $("#address_district").html(companyList[$(this).val()].address[0].dNameTh);
        $("#address_amphure").html(companyList[$(this).val()].address[0].aNameTh);
        $("#address_province").html(companyList[$(this).val()].address[0].pNameTh + " " + companyList[$(this).val()].address[0].zip_code);
        $("#modal_logo_company").attr("src",companyList[$(this).val()].img_logo)
        
        let webHtml = "";
        let iotHtml = "";

        for(let i = 0; i < companyList[$(this).val()].webservice.length; i++)
        {
            webHtml += `
                        <div class="row">
                            <div class="col-6">
                                <h6 class="text-left">${companyList[$(this).val()].webservice[i].service_name}</h6>
                            </div>
                            <div class="col-6">
                                <h6 class="text-left">${companyList[$(this).val()].webservice[i].description}</h6>
                            </div>
                        </div> `;
        }

        for(let i = 0; i < companyList[$(this).val()].iotservice.length; i++)
        {
            iotHtml += `
                        <div class="row">
                            <div class="col-6">
                                <h6 class="text-left">${companyList[$(this).val()].iotservice[i].iot_name}</h6>
                            </div>
                            <div class="col-6">
                                <h6 class="text-left">${companyList[$(this).val()].iotservice[i].description}</h6>
                            </div>
                        </div> `;
        }

        $("#webserive_section").html(webHtml);
        $("#iotserive_section").html(iotHtml);

        $("#company_detail").modal('show');

    });
}

